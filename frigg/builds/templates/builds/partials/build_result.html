{% load i18n emoji_tags %}
<div class="pure-u-1">
  <h3>
    {{ build.project.owner }} / {{ build.project.name }} / {{ build.branch }}
    <a href="{{ build.pull_request_url }}" class="no-underline"><i class="fa fa-github"></i></a>
  </h3>
</div>

<div class="pure-u-1 pure-u-lg-1-2">
  <strong>{% trans 'Branch' %}:</strong> {{ build.branch }} <br/>
  <strong>{% trans 'Commit hash' %}:</strong> {{ build.sha }} <br/>
  {% if build.author %}
    <strong>{% trans 'Author' %}:</strong> {{ build.author }} <br/>
  {% endif %}
  <strong>{% trans 'Timestamp' %}:</strong> <span class="timestamp">{{ build.created_at }}</span> <br/>
  {% if build.result.coverage %}
    <strong>{% trans 'Coverage' %}:</strong> {{ build.result.coverage }}% <br/>
    <strong>{% trans 'Coverage difference from last master build' %}:</strong>
    {% if build.result.coverage_diff > 0 %} + {% endif %}
    {{ build.result.coverage_diff }}% <br/>
  {% endif %}
  <strong>{% trans 'State' %}:</strong>
  {% if build.is_pending or build.result.still_running %}
    {% trans 'pending' %}
  {% elif build.result.succeeded %}
    {% trans 'success' %}
  {% elif build.result.tasks.0.task == '' and not build.result.tasks.0.succeeded %}
    {% trans 'error' %}
  {% else %}
    {% trans 'failure' %}
  {% endif %}
</div>

<div class="pure-u-1 pure-u-lg-1-2">
  {% if build.message %}
    <strong>Message:</strong><br/>
    {{ build.rendered_message|emoji_replace }}
  {% endif %}
</div>

<div class="pure-u-1">
  {% if not build.project.approved %}
    <p class="lead text-center">
      {% trans 'This project is not approved, and needs to be approved before a build can run.' %}
    </p>
  {% elif build.is_pending %}
    {% if build.estimated_finish_time %}
      <p class="lead text-center">
        This build has not yet finished and is estimated to finish in {{ build.estimated_finish_time|timeuntil }}.
      </p>
    {% endif %}
    {% include "builds/partials/loading.html" %}
  {% elif build.result.tasks.0.task == '' and not build.result.tasks.0.succeeded %}
    <p class="lead text-center">
      {% trans 'This project has no defined tasks and frigg could not find any appropiate tasks for the project.' %}
    </p>
  {% else %}
    <div class="build-logs">
      {% for task in build.result.tasks %}
        <div>
          {% if task.pending %}
            <h3><i class="fa fa-check fa-spinner fa-spin orange"></i> {{ task.task }}</h3>
          {% else %}
            <h3>
              <i class="fa {% if task.return_code == 0 or task.return_code == '' %}fa-check green{% else %}fa-times red{% endif %}"></i>
              {{ task.task }} <span class="meta">Return code: {{ task.return_code }}</span>
            </h3>
            <pre{% if task.return_code == 0 or task.return_code == '' %} style="display: none;"{% endif %}><code class="colorify">{{ task.log }}</code></pre>
          {% endif %}
        </div>
      {% endfor %}
    </div>
  {% endif %}
</div>

