services:
  - redis-server
  - postgresql

tasks:
  - flake8
  - isort -c -rc frigg
  - tox
  - coverage report --fail-under=90
  - coverage xml
 
deploy_tasks:
  - pip3 install gunicorn -r requirements/base.txt
  - npm -g install yuglify
  - make frigg/settings/local.py
  - createdb frigg
  - python3 manage.py migrate
  - python3 manage.py loaddata frigg/builds/fixtures/users.json
  - python3 manage.py loaddata frigg/builds/fixtures/test_views.yaml
  - python3 manage.py collectstatic --noinput
  - gunicorn -D -b 0.0.0.0:8000 frigg.wsgi

verbose_tasks:
  - coverage report --fail-under=90

coverage:
  path: coverage.xml
  parser: python

deployment:
  image: frigg/frigg-test-base
